let tableName,tableId,className,columnsName,langage,linkGitHub='<a href="https://github.com/n-deleforge/class-manager-generator">GitHub</a>',linkHome='<a href="https://nicolas-deleforge.fr/">nd</a>',version="1.1";const FR=[];FR.lang="FR",FR.button="Générer",FR.error="Tous les champs sont nécessaires.",FR.footer="Disponible sur "+linkGitHub+" (v "+version+") - Hébergé sur "+linkHome,FR.tableNameLabel="NOM DE LA TABLE",FR.tableNameDesc="Nom de table qui correspond au nom tel qu'il est dans votre base de données SQL.",FR.tableIdLabel="NOM DU CHAMP ID",FR.tableIdDesc="Champ ID de votre table SQL.",FR.columnsNameLabel="NOM DE TOUTES LES COLONNES",FR.columnsNameDesc='Les différentes colonnes de votre table SQL (doit respecter le format exact suivant : "col1,col2,col3").',FR.classNameLabel="NOM CLASS/MANAGER",FR.classNameDesc="Nom de la Class et du Manager que vous allez créer (une majuscule est automatiquement appliquée).";const EN=[];function display(){get("#lang").innerHTML=langage.lang,get("#generate").innerHTML=langage.button,get("#error").innerHTML=langage.error,get("#footer").innerHTML=langage.footer,get("#tableNameLabel").innerHTML="&#10145 "+langage.tableNameLabel,get("#tableNameDesc").innerHTML=langage.tableNameDesc,get("#tableIdLabel").innerHTML="&#10145 "+langage.tableIdLabel,get("#tableIdDesc").innerHTML=langage.tableIdDesc,get("#columnsNameLabel").innerHTML="&#10145 "+langage.columnsNameLabel,get("#columnsNameDesc").innerHTML=langage.columnsNameDesc,get("#classNameLabel").innerHTML="&#10145 "+langage.classNameLabel,get("#classNameDesc").innerHTML=langage.classNameDesc}function generateClass(){return"<?php\nclass "+className+"\n{\n"+generateAttributes()+"\n"+generateGetterSetter()+"\n"+genererConstruct()+"\n\n}"}function generateAttributes(){let e="";for(let n=0;n<columnsName.length;n++)e+="private $_"+columnsName[n]+";\n";return e}function generateGetterSetter(){let e="";for(let n=0;n<columnsName.length;n++)e+="public function get"+ucFirst(columnsName[n])+"()\n{\n return $this->_"+columnsName[n]+";\n}\n",e+="public function set"+ucFirst(columnsName[n])+"($_"+columnsName[n]+")\n{\n return $this->_"+columnsName[n]+" = $_"+columnsName[n]+";\n}\n";return e}function genererConstruct(){return'public function __construct(array $options = [])\n    {\n        if (!empty($options))\n        {\n            $this->hydrate($options);\n        }\n    }\n\n    public function hydrate($data)\n    {\n        foreach ($data as $key => $value) {\n            $methode = "set" . ucfirst($key);\n            if (is_callable(([$this, $methode])))\n            {\n                $this->$methode($value);\n            }\n        }\n    }'}function generateManager(){let e=columnsName.find(e=>e==tableId);return"undefined"!=e&&columnsName.splice(columnsName.indexOf(e),1),"<?php\nclass "+className+"Manager\n{\n"+generateAdd()+"\n\n"+generateUpdate()+"\n\n"+generateDelete()+"\n\n"+generateFindById()+"\n\n"+generateGetList()+"\n\n}"}function generateAdd(){let e="",n="",t="";for(let a=0;a<columnsName.length;a++)e+=columnsName[a]+",",n+=":"+columnsName[a]+",",t+='$q->bindValue(":'+columnsName[a]+'", $obj->get'+ucFirst(columnsName[a])+"());\n";return e=e.substr(0,e.length-1),n=n.substr(0,n.length-1),"public static function add("+className+' $obj)\n{\n$db = DbConnect::getDb();\n$q = $db->prepare("INSERT INTO '+tableName+" ("+e+") VALUES ("+n+')");\n'+t+"$q->execute();\n}"}function generateUpdate(){let e="",n="";for(let t=0;t<columnsName.length;t++)e+=columnsName[t]+"=:"+columnsName[t]+", ",n+='$q->bindValue(":'+columnsName[t]+'", $obj->get'+ucFirst(columnsName[t])+"());\n";return n+='$q->bindValue(":'+tableId+'", $obj->get'+ucFirst(tableId)+"());\n",e=e.substr(0,e.length-2),"public static function update("+className+' $obj)\n{\n$db = DbConnect::getDb();\n$q = $db->prepare("UPDATE '+tableName+" SET "+e+" WHERE "+tableId+"=:"+tableId+'");\n'+n+"$q->execute();\n}"}function generateDelete(){return"public static function delete("+className+' $obj)\n{\n$db = DbConnect::getDb();\n$db->exec("DELETE FROM '+tableName+" WHERE "+tableId+'=" . $obj->get'+ucFirst(tableId)+"());\n}"}function generateFindById(){return'public static function findById($id)\n{\n$db = DbConnect::getDb();\n$id = (int) $id;\n$q = $db->query("SELECT * FROM '+tableName+" WHERE "+tableId+'=".$id);\n$results = $q->fetch(PDO::FETCH_ASSOC);\nif ($results != false) {\nreturn new '+className+" ($results);\n }else {\nreturn false;\n}\n}"}function generateGetList(){return'public static function getList()\n{\n$db = DbConnect::getDb();\n$langage = [];\n$q = $db->query("SELECT * FROM '+tableName+'");\nwhile ($donnees = $q->fetch(PDO::FETCH_ASSOC)) {\nif ($donnees != false) {\n$langage[] = new '+className+"($donnees);\n}\n}\nreturn $langage;\n}"}function get(e){return-1!=e.search("#")&&null!=document.getElementById(e.split("#")[1])?document.getElementById(e.split("#")[1]):-1!=e.search("~")&&null!=document.querySelectorAll(e.split("~")[1])?document.querySelectorAll(e.split("~")[1]):-1!=e.search("\\.")&&0!=document.querySelectorAll(e).length?document.querySelectorAll(e):void 0}function download(e,n){let t=new Blob([e],{type:"text/plain"}),a=document.createElement("a");a.download=n,a.href=window.URL.createObjectURL(t),a.click()}EN.lang="EN",EN.button="Generate",EN.error="All the fields have to be filled.",EN.footer="Available on "+linkGitHub+" (v "+version+") - Hosted on "+linkHome,EN.tableNameLabel="TABLE NAME",EN.tableNameDesc="Name of the table in your database.",EN.tableIdLabel="ID FIELD NAME",EN.tableIdDesc="Name of the ID field of your table.",EN.columnsNameLabel="COLUMNS NAMES",EN.columnsNameDesc="All the columns' names of your table. Must respect this format : col1,col2,col3.",EN.classNameLabel="CLASS/MANAGER NAME",EN.classNameDesc="Name of the Class and the Manager.",langage="FR"==localStorage.getItem("nd-generatorLang")?FR:EN,display(),get("#lang").addEventListener("click",function(){"FR"==get("#lang").innerHTML?(localStorage.setItem("nd-generatorLang","EN"),langage=EN):(localStorage.setItem("nd-generatorLang","FR"),langage=FR),display()}),get("#generate").addEventListener("click",function(){let e=0,n=get(".gen");for(let t=0;t<n.length;t++)""===n[t].value&&e++;0==e?(get("#error").style.display="none",tableName=get("#tableName").value,tableId=get("#tableId").value,className=ucFirst(get("#className").value),columnsName=get("#columnsName").value.split(","),download(generateClass(),className+".Class.php"),download(generateManager(),className+"Manager.Class.php")):get("#error").style.display="block"});